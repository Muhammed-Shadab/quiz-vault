<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuizWorld - All Quiz Results</title>
    <link rel="stylesheet" th:href="@{/css/studentHomePage.css}">
    <style>
        .all-results-page {
            min-height: 100vh;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .page-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .page-title {
            font-size: 36px;
            font-weight: 700;
            color: #ffffff;
            margin: 0;
        }

        .page-subtitle {
            color: rgba(255, 255, 255, 0.6);
            font-size: 15px;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s;
        }

        .stat-card:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%);
            border-color: rgba(107, 127, 219, 0.3);
            transform: translateY(-2px);
        }

        .stat-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 13px;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: #ffffff;
        }

        .search-filter-section {
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 300px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-box input {
            background: none;
            border: none;
            color: #ffffff;
            outline: none;
            width: 100%;
            font-size: 14px;
        }

        .search-box input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
        }

        .filter-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .filter-btn:hover, .filter-btn.active {
            background: rgba(79, 93, 201, 0.2);
            border-color: rgba(79, 93, 201, 0.4);
            color: #6b7fdb;
        }

        .results-table-container {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
        }

        .results-table thead {
            background: linear-gradient(135deg, rgba(79, 93, 201, 0.2) 0%, rgba(79, 93, 201, 0.1) 100%);
        }

        .results-table th {
            text-align: left;
            padding: 18px 24px;
            font-weight: 600;
            color: #ffffff;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .results-table tbody tr {
            transition: all 0.3s;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .results-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .results-table tbody tr:last-child {
            border-bottom: none;
        }

        .results-table td {
            padding: 20px 24px;
            font-size: 15px;
            color: rgba(255, 255, 255, 0.9);
        }

        .row-number {
            color: rgba(255, 255, 255, 0.5);
            font-weight: 600;
            font-size: 14px;
        }

        .quiz-name-cell {
            font-weight: 500;
            color: #ffffff;
        }

        .score-cell {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .score-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }

        .score-low {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.4);
        }

        .score-medium {
            background: rgba(234, 179, 8, 0.2);
            color: #eab308;
            border: 1px solid rgba(234, 179, 8, 0.4);
        }

        .score-high {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.4);
        }

        .score-perfect {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.4);
        }

        .score-icon {
            font-size: 16px;
        }

        .date-cell {
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
        }

        .action-cell {
            text-align: right;
        }

        .view-details-btn {
            background: rgba(79, 93, 201, 0.2);
            border: 1px solid rgba(79, 93, 201, 0.3);
            color: #6b7fdb;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .view-details-btn:hover {
            background: rgba(79, 93, 201, 0.3);
            border-color: rgba(79, 93, 201, 0.5);
        }

        .empty-state {
            text-align: center;
            padding: 80px 40px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
        }

        .empty-icon {
            font-size: 80px;
            margin-bottom: 20px;
            opacity: 0.3;
            filter: grayscale(1);
        }

        .empty-title {
            font-size: 24px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .empty-description {
            font-size: 15px;
            color: rgba(255, 255, 255, 0.4);
            max-width: 400px;
            margin: 0 auto 30px;
        }

        .empty-action-btn {
            background: rgba(79, 93, 201, 0.2);
            border: 1px solid rgba(79, 93, 201, 0.4);
            color: #6b7fdb;
            padding: 12px 28px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .empty-action-btn:hover {
            background: rgba(79, 93, 201, 0.3);
            border-color: rgba(79, 93, 201, 0.6);
            transform: translateY(-2px);
        }

        @media (max-width: 1024px) {
            .results-table-container {
                overflow-x: auto;
            }

            .results-table {
                min-width: 800px;
            }
        }

        @media (max-width: 768px) {
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }

            .search-filter-section {
                flex-direction: column;
            }

            .search-box {
                min-width: 100%;
            }

            .filter-buttons {
                width: 100%;
                overflow-x: auto;
            }

            .results-table th,
            .results-table td {
                padding: 12px 16px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
<div class="container all-results-page">
    <header>
        <div class="logo">QuizWorld</div>
        <div class="header-actions">
            <a href="/studentHomePage" class="back-btn">
                <span>‚Üê</span>
                Back to Dashboard
            </a>
            <button class="logout-btn">
                <span>‚öôÔ∏è</span>
            </button>
        </div>
    </header>

    <div class="main-layout">
        <main class="main-content">
            <!-- Page Header -->
            <div class="page-header">
                <div class="page-info">
                    <h1 class="page-title">Quiz Performance History üìä</h1>
                    <p class="page-subtitle">Track your progress and review all quiz results</p>
                </div>
            </div>

            <!-- Statistics Cards -->
            <div class="stats-container" th:if="${performance != null and !performance.isEmpty()}">
                <div class="stat-card">
                    <div class="stat-icon">üìù</div>
                    <div class="stat-label">Total Quizzes</div>
                    <div class="stat-value" th:text="${performance.size()}">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚≠ê</div>
                    <div class="stat-label">Average Score</div>
                    <div class="stat-value" th:text="${avgScore + '%'}">--</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üèÜ</div>
                    <div class="stat-label">Best Score</div>
                    <div class="stat-value" th:text="${bestScore + '%'}">--</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìà</div>
                    <div class="stat-label">Pass Rate</div>
                    <div class="stat-value" id="passRate">--</div>
                </div>
            </div>

            <!-- Search and Filter Section -->
            <div class="search-filter-section" th:if="${performance != null and !performance.isEmpty()}">
                <div class="search-box">
                    <span>üîç</span>
                    <input type="text" id="searchInput" placeholder="Search by quiz name...">
                </div>
                <div class="filter-buttons">
                    <button class="filter-btn active" data-filter="all">All Results</button>
                    <button class="filter-btn" data-filter="high">High Scores</button>
                    <button class="filter-btn" data-filter="medium">Medium Scores</button>
                    <button class="filter-btn" data-filter="low">Low Scores</button>
                </div>
            </div>

            <!-- Results Table -->
            <div th:if="${performance != null and !performance.isEmpty()}">
                <div class="results-table-container">
                    <table class="results-table">
                        <thead>
                        <tr>
                            <th style="width: 80px;">#</th>
                            <th>Quiz Name</th>
                            <th style="width: 200px;">Score</th>
                            <th style="width: 180px;">Date Taken</th>
                        </tr>
                        </thead>
                        <tbody id="resultsTableBody">
                        <!-- Loop through all results -->
                        <tr th:each="record, iterStat : ${performance}" class="result-row"
                            th:attr="data-score=${record[1].replace('%','')}">
                            <td class="row-number" th:text="${iterStat.index + 1}">1</td>
                            <td class="quiz-name-cell" th:text="${record[0]}">Quiz Title</td>
                            <td>
                                <div class="score-cell">
                                    <span class="score-badge"
                                          th:classappend="${record[1].replace('%','') lt '40'} ? 'score-low' : (${record[1].replace('%','') lt '65'} ? 'score-medium' : (${record[1].replace('%','') ge '90'} ? 'score-perfect' : 'score-high'))">
                                        <span class="score-icon"
                                              th:text="${record[1].replace('%','') lt '40'} ? 'üòû' : (${record[1].replace('%','') lt '65'} ? 'üòê' : (${record[1].replace('%','') ge '90'} ? 'üéâ' : 'üòä'))">
                                        </span>
                                        <span th:text="${record[1]}">Score</span>
                                    </span>
                                </div>
                            </td>
                            <td class="date-cell" th:text="${record[2]}">Date</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Empty State -->
            <div th:if="${performance == null or performance.isEmpty()}" class="empty-state">
                <div class="empty-icon">üìà</div>
                <h2 class="empty-title">No Quiz Results Yet</h2>
                <p class="empty-description">
                    You haven't taken any quizzes yet. Start taking quizzes to see your performance history here.
                </p>
                <a href="/student/dashboard" class="empty-action-btn">
                    Browse Active Quizzes ‚Üí
                </a>
            </div>
        </main>
    </div>
</div>

<script>
    // Calculate pass rate
    function calculatePassRate() {
        const rows = document.querySelectorAll('.result-row');
        if (rows.length === 0) return;

        let passCount = 0;
        rows.forEach(row => {
            const score = parseFloat(row.dataset.score);
            if (score >= 40) passCount++;
        });

        const passRate = ((passCount / rows.length) * 100).toFixed(0);
        document.getElementById('passRate').textContent = passRate + '%';
    }

    // Search functionality
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
        searchInput.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('.result-row');

            rows.forEach(row => {
                const quizName = row.querySelector('.quiz-name-cell').textContent.toLowerCase();
                if (quizName.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });
    }

    // Filter functionality
    const filterButtons = document.querySelectorAll('.filter-btn');

    filterButtons.forEach(button => {
        button.addEventListener('click', function() {
            filterButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');

            const filter = this.dataset.filter;
            const rows = document.querySelectorAll('.result-row');

            rows.forEach(row => {
                const score = parseFloat(row.dataset.score);
                let show = false;

                switch(filter) {
                    case 'all':
                        show = true;
                        break;
                    case 'high':
                        show = score >= 65;
                        break;
                    case 'medium':
                        show = score >= 40 && score < 65;
                        break;
                    case 'low':
                        show = score < 40;
                        break;
                }

                row.style.display = show ? '' : 'none';
            });
        });
    });

    // Logout button handler
    document.querySelector('.logout-btn').addEventListener('click', function() {
        if (confirm('Are you sure you want to logout?')) {
            console.log('Logging out...');
            // window.location.href = '/logout';
        }
    });

    // Initialize on page load
    window.addEventListener('DOMContentLoaded', function() {
        calculatePassRate();
        console.log('All Results page loaded successfully');
    });
</script>
</body>
</html>